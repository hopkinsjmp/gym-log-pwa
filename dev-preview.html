<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dev Preview - Gym Log</title>
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; margin:16px; background:#0b1220; color:#f9fafb }
    .panel { background: #06101a; padding:12px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); }
    .row { display:flex; gap:8px; margin-top:8px; }
    button { padding:8px 12px; border-radius:8px; border:none; background:#7c3aed; color:white; cursor:pointer }
    iframe { width:100%; height: calc(100vh - 220px); border: none; margin-top:12px; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.6); }
    pre { background:rgba(255,255,255,0.02); padding:8px; border-radius:6px; overflow:auto }
  </style>
</head>
<body>
  <h2>Gym Log â€” Dev Preview</h2>
  <div class="panel">
    <div>This preview will set fake localStorage data and load <code>index.html</code> inside the iframe so you can iterate on layout without hitting the Sheets backend or Google Sign-In.</div>
    <div class="row">
      <button id="loadMock">Load mock data & open preview</button>
      <button id="clearMock">Clear mock data</button>
      <button id="reloadIframe">Reload iframe</button>
    </div>
    <div style="margin-top:8px; font-size:0.95rem; opacity:0.9">Notes: run a simple static server in the project root (see below) and open this page at <code>/dev-preview.html</code>.</div>
    <div style="margin-top:8px; font-size:0.92rem">Example server command (run from project root):</div>
    <pre>python3 -m http.server 8000
# then open http://localhost:8000/dev-preview.html</pre>
  </div>

  <iframe id="preview" src="about:blank" title="dev preview"></iframe>

  <script>
    // Fake data used by the preview. Adjust as needed.
    const MOCK_EXERCISES = [
      { id: 'ex-bench', name: 'Bench Press', notes: '' },
      { id: 'ex-squat', name: 'Back Squat', notes: '' },
      { id: 'ex-row', name: 'Barbell Row', notes: '' },
      { id: 'ex-press', name: 'Overhead Press', notes: '' },
      { id: 'ex-dl', name: 'Deadlift', notes: '' },
      { id: 'ex-pull', name: 'Pull-ups', notes: '' }
    ];

    const MOCK_SETS = [
      { id: 's1', exerciseId: 'ex-bench', ts: new Date(Date.now()-3600*1000*24).toISOString(), reps: 5, weight: '80kg' },
      { id: 's2', exerciseId: 'ex-bench', ts: new Date(Date.now()-3600*1000*20).toISOString(), reps: 5, weight: '82.5kg' },
      { id: 's3', exerciseId: 'ex-squat', ts: new Date(Date.now()-3600*1000*48).toISOString(), reps: 3, weight: '120kg' },
      { id: 's4', exerciseId: 'ex-row', ts: new Date().toISOString(), reps: 8, weight: '60kg' }
    ];

    function setMockLocalStorage() {
      try {
        localStorage.setItem('gym-exercises', JSON.stringify(MOCK_EXERCISES));
        localStorage.setItem('gym-sets', JSON.stringify(MOCK_SETS));
        // Ensure queue and logged ids are empty so preview behaves like a fresh user
        localStorage.setItem('gym-log-queue', JSON.stringify([]));
        localStorage.setItem('gym-logged-ids', JSON.stringify(MOCK_SETS.map(s => s.id)));
        // Remove any GSI token so preview shows signed-out state; if you'd rather show signed-in, set a fake token
        localStorage.removeItem('gym-gsi-idtoken');
        alert('Mock data loaded into localStorage. Now loading preview.');
      } catch (e) {
        alert('Failed to set mock data: ' + e);
      }
    }

    function clearMockLocalStorage() {
      try {
        ['gym-exercises','gym-sets','gym-log-queue','gym-logged-ids','gym-gsi-idtoken'].forEach(k => localStorage.removeItem(k));
        alert('Mock localStorage keys removed.');
      } catch (e) {
        alert('Failed to clear mock data: ' + e);
      }
    }

    function loadPreview() {
      // The iframe will share origin/localStorage when served from same host; ensure index.html is reachable
      const iframe = document.getElementById('preview');
      iframe.src = './index.html';
    }

    document.getElementById('loadMock').addEventListener('click', () => {
      setMockLocalStorage();
      // small delay to ensure localStorage writes have settled before iframe loads
      setTimeout(loadPreview, 150);
    });
    document.getElementById('clearMock').addEventListener('click', () => {
      clearMockLocalStorage();
    });
    document.getElementById('reloadIframe').addEventListener('click', () => {
      const iframe = document.getElementById('preview');
      iframe.contentWindow && iframe.contentWindow.location.reload();
    });

    // Auto-load mock data if ?mock=1 is present in URL
    if (location.search.indexOf('mock=1') !== -1) {
      setMockLocalStorage();
      setTimeout(loadPreview, 120);
    }
  </script>
</body>
</html>
