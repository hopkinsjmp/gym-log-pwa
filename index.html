<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Gym Log</title>

  <!-- PWA basics -->
  <meta name="theme-color" content="#111827" />
  <link rel="manifest" href="./manifest.json" />

  <!-- Nice-to-haves (Android/Chrome + iOS-ish) -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="GymLog" />

  <!-- Optional: you can add an iOS icon later if you want -->
  <!-- <link rel="apple-touch-icon" href="./icon-192.png" /> -->

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 16px;
      background: #111827;
      color: #f9fafb;
    }

    h1 {
      margin: 0 0 12px;
      font-size: 1.4rem;
    }

    .hint {
      margin: 0 0 12px;
      opacity: 0.75;
      font-size: 0.95rem;
      line-height: 1.3;
    }

    textarea {
      width: 100%;
      min-height: 240px;
      padding: 12px;
      font-size: 16px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color: #f9fafb;
      outline: none;
      resize: vertical;
      box-sizing: border-box;
    }

    textarea:focus {
      border-color: rgba(124, 58, 237, 0.7);
      box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.25);
    }

    .row {
      display: flex;
      gap: 10px;
      margin-top: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 16px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
      background: #7c3aed;
      color: white;
      font-weight: 600;
      cursor: pointer;
    }

    button.secondary {
      background: rgba(255,255,255,0.12);
      color: #f9fafb;
    }

    .status {
      font-size: 0.95rem;
      opacity: 0.85;
      min-height: 1.2em;
    }

    .tiny {
      font-size: 0.85rem;
      opacity: 0.75;
      margin-top: 10px;
      line-height: 1.35;
    }

    code {
      background: rgba(255,255,255,0.08);
      padding: 2px 6px;
      border-radius: 6px;
    }

    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
  </style>
</head>

<body>
  <h1>üèãÔ∏è Gym Log</h1>
  <p class="hint">Type your workout notes. It auto-saves locally on this device.</p>

  <textarea
    id="log"
    placeholder="e.g.
Bench Press
20kg x 12
30kg x 8
Notes: felt good"
  ></textarea>

  <div class="row">
    <button id="save" type="button">Save</button>
    <button class="secondary" id="clear" type="button">Clear</button>
    <div class="status" id="status"></div>
  </div>

  <div class="tiny" id="pwaInfo"></div>

  <script>
    const STORAGE_KEY = "gym-log";

    const textarea = document.getElementById("log");
    const statusEl = document.getElementById("status");
    const saveBtn = document.getElementById("save");
    const clearBtn = document.getElementById("clear");
    const pwaInfo = document.getElementById("pwaInfo");

    // Load saved data on startup
    textarea.value = localStorage.getItem(STORAGE_KEY) || "";

    function flashStatus(msg, ms = 1500) {
      statusEl.textContent = msg;
      window.clearTimeout(flashStatus._t);
      flashStatus._t = window.setTimeout(() => (statusEl.textContent = ""), ms);
    }

    function saveNow() {
      localStorage.setItem(STORAGE_KEY, textarea.value);
      flashStatus("Saved locally ‚úîÔ∏è");
    }

    saveBtn.addEventListener("click", saveNow);

    // Auto-save as you type (debounced)
    let t = null;
    textarea.addEventListener("input", () => {
      clearTimeout(t);
      t = setTimeout(() => {
        localStorage.setItem(STORAGE_KEY, textarea.value);
        flashStatus("Auto-saved‚Ä¶", 800);
      }, 300);
    });

    clearBtn.addEventListener("click", () => {
      textarea.value = "";
      localStorage.removeItem(STORAGE_KEY);
      flashStatus("Cleared ‚úîÔ∏è");
    });

    // --- Service worker registration (helps installability + offline) ---
    // sw.js must be in the same folder as this index.html
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", async () => {
        try {
          const reg = await navigator.serviceWorker.register("./sw.js");
          // Optional: you can show this if you want
          // console.log("Service worker registered:", reg.scope);
        } catch (err) {
          console.warn("Service worker registration failed:", err);
          flashStatus("SW failed to register (check console) ‚ö†Ô∏è", 2000);
        }
      });
    }

    // Tiny debug info to help confirm install / context
    const isStandalone =
      window.matchMedia("(display-mode: standalone)").matches ||
      window.navigator.standalone === true;

    const href = window.location.href;
    pwaInfo.innerHTML = isStandalone
      ? "‚úÖ Running as an installed app (standalone)."
      : `‚ÑπÔ∏è Not installed yet.<br/>
         In Chrome: menu ‚ãÆ ‚Üí <b>Install app</b> (or <b>Add to Home screen</b>).<br/>
         If you don‚Äôt see it, confirm these load with 200 OK:<br/>
         ‚Ä¢ <code>manifest.json</code> ‚Ä¢ <code>sw.js</code> ‚Ä¢ icons.<br/>
         <span class="mono">URL:</span> <code>${href}</code>`;
  </script>
</body>
</html>
